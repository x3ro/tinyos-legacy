#
# Makefile to be included by each application's Makefile for HSN
#

ifndef BASEDIR
   include ../BaseDIR
endif

ifndef HSNDIR
   HSNDIR = ../../tos
endif

LOCAL_PATH += -I. -I$(HSNDIR)/interfaces -I$(HSNDIR)/system -I$(HSNDIR)/lib -I$(HSNDIR)/lib/neighborhood

ifdef CC1K_DEFAULT_FREQ
   LOCAL_DEFINES += -DCC1K_DEFAULT_FREQ=$(CC1K_DEFAULT_FREQ)
else
ifeq ($(MICA2_900MHZ),1)
   LOCAL_DEFINES += -DCC1K_DEFAULT_FREQ=CC1K_914_077_MHZ
endif
endif

ifeq ($(USE_SMAC), 1)
   PLATFORM = $(filter mica mica2, $(MAKECMDGOALS))
   LOCAL_DEFINES += -DUSE_SMAC=1
   LOCAL_DEFINES += -I$(BASEDIR)/../contrib/s-mac/tos/interfaces/
   LOCAL_DEFINES += -I$(BASEDIR)/../contrib/s-mac/tos/system
   LOCAL_DEFINES += -I$(BASEDIR)/../contrib/s-mac/tos/platform/$(PLATFORM)
   LOCAL_DEFINES += -DSMAC_USE_COUNTER_1
   LOCAL_DEFINES += -DSMAC_PERFORMANCE
   BROADCAST_ONLY_SINGLE_HOP_SEQ = 1
   TR_SEND_RATE = 30
   DSDV_RUPINT_DEFAULT = 90
   DSDV_PASSIVE_ACK = 0
endif

ifdef SINK_NODE
   LOCAL_DEFINES += -DSINK_NODE=$(SINK_NODE)
endif

ifdef NO_UART_FRAMED
   LOCAL_DEFINES += -DNO_UART_FRAMED=$(NO_UART_FRAMED)
endif

ifdef TRACE_TARGET
   LOCAL_DEFINES += -DTRACE_TARGET=$(TRACE_TARGET)
endif

ifdef TR_PIGGYBACK_LEN
   LOCAL_DEFINES += -DTR_PIGGYBACK_LEN=$(TR_PIGGYBACK_LEN)
endif

ifdef TR_PLUGIN_LEN
   LOCAL_DEFINES += -DTR_PLUGIN_LEN=$(TR_PLUGIN_LEN)
endif

ifdef TR_SEND_RATE
   LOCAL_DEFINES += -DTR_SEND_RATE=$(TR_SEND_RATE)
endif

ifdef TR_LEAF_DETECTION
   LOCAL_DEFINES += -DTR_LEAF_DETECTION=$(TR_LEAF_DETECTION)
endif

ifdef DSDV_RUPDATE_PIGGYBACK_LEN
   LOCAL_DEFINES += -DDSDV_RUPDATE_PIGGYBACK_LEN=$(DSDV_RUPDATE_PIGGYBACK_LEN)
endif

ifdef DSDV_BI_DIR_QUALITY
   LOCAL_DEFINES += -DDSDV_BI_DIR_QUALITY=$(DSDV_BI_DIR_QUALITY)
else
   LOCAL_DEFINES += -DDSDV_BI_DIR_QUALITY=1
endif

ifdef DSDV_PERSISTANCE
   LOCAL_DEFINES += -DDSDV_PERSISTANCE=$(DSDV_PERSISTANCE)
else
   LOCAL_DEFINES += -DDSDV_PERSISTANCE=1
endif

ifdef DSDV_PASSIVE_ACK
   LOCAL_DEFINES += -DDSDV_PASSIVE_ACK=$(DSDV_PASSIVE_ACK)
else
   LOCAL_DEFINES += -DDSDV_PASSIVE_ACK=1
endif

ifdef USE_SEND_QUEUE
   LOCAL_DEFINES += -DUSE_SEND_QUEUE=$(USE_SEND_QUEUE)
endif

ifdef QUEUE_USE_PACKET_ACK
   LOCAL_DEFINES += -DQUEUE_USE_PACKET_ACK=$(QUEUE_USE_PACKET_ACK)
endif

ifdef PASSIVE_ACK_MAX_RETRIES
   LOCAL_DEFINES += -DPASSIVE_ACK_MAX_RETRIES=$(PASSIVE_ACK_MAX_RETRIES)
endif

ifdef NEIGHBOR_AGE_CACHE_TIMEOUT
   LOCAL_DEFINES += -DNEIGHBOR_AGE_CACHE_TIMEOUT=$(NEIGHBOR_AGE_CACHE_TIMEOUT)
endif

ifdef RUPDATE_RANDOMIZE
   LOCAL_DEFINES += -DRUPDATE_RANDOMIZE=$(RUPDATE_RANDOMIZE)
else
   LOCAL_DEFINES += -DRUPDATE_RANDOMIZE=1
endif

ifdef FAST_START_DSDV
   LOCAL_DEFINES += -DFAST_START_DSDV=$(FAST_START_DSDV)
else
   LOCAL_DEFINES += -DFAST_START_DSDV=1
endif

ifdef DSDV_RUPINT_DEFAULT
   LOCAL_DEFINES += -DDSDV_RUPINT_DEFAULT=$(DSDV_RUPINT_DEFAULT)
endif

ifdef USE_SYNC_ACK
   LOCAL_DEFINES += -DUSE_SYNC_ACK=$(USE_SYNC_ACK)
endif

ifdef MESH
   LOCAL_DEFINES += -DMESH=$(MESH)
endif

ifdef BROADCAST_ONLY_SINGLE_HOP_SEQ
   LOCAL_DEFINES += -DBROADCAST_ONLY_SINGLE_HOP_SEQ=$(BROADCAST_ONLY_SINGLE_HOP_SEQ)
endif

ifdef ADJUVANT_SERVICE_ENABLED_DEFAULT
   LOCAL_DEFINES += -DADJUVANT_SERVICE_ENABLED_DEFAULT=$(ADJUVANT_SERVICE_ENABLED_DEFAULT)
endif

ifdef ADJUVANT_STATUS_DEFAULT
   LOCAL_DEFINES += -DADJUVANT_STATUS_DEFAULT=$(ADJUVANT_STATUS_DEFAULT)
endif

ifdef ADJUVANT_VALUE_DEFAULT
   LOCAL_DEFINES += -DADJUVANT_VALUE_DEFAULT=$(ADJUVANT_VALUE_DEFAULT)
endif

ifdef TXRES_VAL
   LOCAL_DEFINES += -DCONST_TXRES_VAL=$(TXRES_VAL)
endif

ifdef FAST_START_DSDV
   LOCAL_DEFINES += -DFAST_START_DSDV=$(FAST_START_DSDV)
else
   LOCAL_DEFINES += -DFAST_START_DSDV=1
endif

# ONLY in TraceRoute_DSDV.nc. Default is using Reliability Metric
ifdef HOPCOUNT_METRIC
   LOCAL_DEFINES += -DHOPCOUNT_METRIC=$(HOPCOUNT_METRIC)
endif

ifdef ENERGY_METRIC
   LOCAL_DEFINES += -DENERGY_METRIC=$(ENERGY_METRIC)
endif

ifdef SMAC_ENERGY_METRIC
   LOCAL_DEFINES += -DSMAC_ENERGY_METRIC=$(SMAC_ENERGY_METRIC)
endif
#actual SMAC energy
ifdef SMAC_ENERGY
   LOCAL_DEFINES += -DSMAC_ENERGY=$(SMAC_ENERGY)
endif

#SMAC Energy model
ifdef SMAC_ENERGY_MODEL
   LOCAL_DEFINES += -DSMAC_ENERGY_MODEL=$(SMAC_ENERGY_MODEL)
endif

ifdef PROGVER
   LOCAL_DEFINES += -DCONST_PROGVER=$(PROGVER)
endif

LOCAL_DEFINES += -DBUILD_DAY=$(shell date +%d | sed 's/^0//')
LOCAL_DEFINES += -DBUILD_MONTH=$(shell date +%m | sed 's/^0//')
LOCAL_DEFINES += -DBUILD_YEAR=$(shell date +%y | sed 's/^0//')

PFLAGS := -tosdir=$(BASEDIR) $(LOCAL_PATH) $(LOCAL_DEFINES) $(PFLAGS)

PROGRAMMER_EXTRA_FLAGS+=-v

include $(BASEDIR)/../apps/Makerules
